<div class="container full-width">
  <div class="dashboard-header">
    <h1>Resumo Mensal - <%= l(Date.today, format: "%B %Y").capitalize %></h1>
    <p class="text-gray-600 my-2">Período: <%= Date.parse(@start_date).strftime("%d/%m/%Y") %> - <%= Date.parse(@end_date).strftime("%d/%m/%Y") %></p>
  </div>

  <div class="summary-cards">
    <div class="summary-card">
      <div class="label block mb-1">Saldo Inicial (01/<%= Date.today.strftime("%m") %>)</div>
      <div class="value block whitespace-nowrap"><%= number_to_currency(@initial_balance, unit: "R$ ", separator: ",", delimiter: ".") %></div>
    </div>
    
    <div class="summary-card highlight-positive">
      <div class="label block mb-1">Total Entradas</div>
      <div class="value block whitespace-nowrap">+ <%= number_to_currency(@total_inflow, unit: "R$ ", separator: ",", delimiter: ".") %></div>
    </div>

    <div class="summary-card highlight-negative">
      <div class="label block mb-1">Total Saídas</div>
      <div class="value block whitespace-nowrap">- <%= number_to_currency(@total_outflow, unit: "R$ ", separator: ",", delimiter: ".") %></div>
    </div>

    <div class="summary-card">
      <div class="label block mb-1">Dívidas Manuais (Mês)</div>
      <div class="value block whitespace-nowrap">- <%= number_to_currency(@total_debts, unit: "R$ ", separator: ",", delimiter: ".") %></div>
    </div>

    <div class="summary-card primary">
      <div class="label block mb-1">Saldo Final (Hoje)</div>
      <div class="value block whitespace-nowrap"><%= number_to_currency(@current_balance, unit: "R$ ", separator: ",", delimiter: ".") %></div>
    </div>
  </div>

  <div class="home-grid">
    <div class="half-column">
      <h2>Ultimas Transações</h2>
      <% if @statement_data && @statement_data['transacoes'].present? %>
        <ul class="transaction-list">
          <% @statement_data['transacoes'].first(5).each do |tx| %>
            <li class="transaction-item compact">
              <span class="date"><%= Date.parse(tx['dataEntrada']).strftime("%d/%m") rescue tx['dataEntrada'] %></span>
              <span class="desc"><%= tx['titulo'] || tx['descricao'] %></span>
              <span class="amount <%= tx['tipoOperacao'] == 'C' ? 'positive' : 'negative' %>">
                <%= tx['tipoOperacao'] == 'C' ? '+' : '-' %> <%= number_to_currency(tx['valor'], unit: "R$ ", separator: ",", delimiter: ".") %>
              </span>
            </li>
          <% end %>
        </ul>
        <div class="view-more">
          <%= link_to "Ver Extrato Completo", statements_path, class: "link-action" %>
        </div>
      <% else %>
        <p class="empty-state">Sem transações no período.</p>
      <% end %>
    </div>

    <div class="half-column">
      <h2>Dívidas Próximas</h2>
      <% if @debts.any? %>
        <ul class="debt-list">
          <% @debts.first(5).each do |debt| %>
            <li class="transaction-item compact">
              <span class="date"><%= debt.date&.strftime("%d/%m") || "--/--" %></span>
              <span class="desc"><%= debt.name %></span>
              <span class="amount neg"><%= number_to_currency(debt.value, unit: "R$ ", separator: ",", delimiter: ".") %></span>
            </li>
          <% end %>
        </ul>
        <div class="view-more">
          <%= link_to "Gerenciar Dívidas", debts_path, class: "link-action" %>
        </div>
      <% else %>
        <p class="empty-state">Nenhuma dívida pendente.</p>
      <% end %>
    </div>
  </div>
</div>
